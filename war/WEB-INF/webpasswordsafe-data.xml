<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright 2008 Josh Drummond

    This file is part of WebPasswordSafe.

    WebPasswordSafe is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    WebPasswordSafe is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with WebPasswordSafe; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-->
<beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">

		<!--  database settings -->
        <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
                <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost/webpasswordsafe"/>
                <property name="username" value="wps"/>
                <property name="password" value="wps"/>
        </bean>

		<!--  object relational mapping settings -->
        <bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
                <property name="dataSource" ref="dataSource"/>
                <property name="configurationClass" value="org.hibernate.cfg.AnnotationConfiguration" />
                <property name="hibernateProperties">
                        <props>
                                <prop key="hibernate.show_sql">true</prop>
                                <prop key="hibernate.dialect">org.hibernate.dialect.MySQLInnoDBDialect</prop>
                                <!--<prop key="hibernate.hbm2ddl.auto">create-drop</prop>-->
                                <prop key="hibernate.hbm2ddl.auto">update</prop>
                        </props>
                </property>
                <property name="annotatedClasses">
                        <list>
                                <value>com.joshdrummond.webpasswordsafe.common.model.Subject</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.User</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.Group</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.Password</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.PasswordData</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.PasswordAccessAudit</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.Permission</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.Template</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.TemplateDetail</value>
                                <value>com.joshdrummond.webpasswordsafe.common.model.Tag</value>
                        </list>
                </property>
        </bean>
        
        <!-- Gilead configuration -->
        <bean id="proxyStore" class="net.sf.gilead.core.store.stateless.StatelessProxyStore" />
        <bean id="persistenceUtil" class="net.sf.gilead.core.hibernate.spring.HibernateSpringUtil" >
        	<property name="sessionFactory" ref="sessionFactory" />
        </bean>
        <bean id="persistentBeanManager" class="net.sf.gilead.core.PersistentBeanManager">
        	<property name="persistenceUtil" ref="persistenceUtil" />
        	<property name="proxyStore" ref="proxyStore" />
        </bean>
        
        <!--  data access objects -->
        <bean id="userDAO" class="com.joshdrummond.webpasswordsafe.server.dao.UserDAOHibernate">
        	<property name="sessionFactory" ref="sessionFactory" />
        </bean>
        <bean id="passwordDAO" class="com.joshdrummond.webpasswordsafe.server.dao.PasswordDAOHibernate">
        	<property name="sessionFactory" ref="sessionFactory" />
        </bean>
        <bean id="tagDAO" class="com.joshdrummond.webpasswordsafe.server.dao.TagDAOHibernate">
        	<property name="sessionFactory" ref="sessionFactory" />
        </bean>
        <bean id="passwordAccessAuditDAO" class="com.joshdrummond.webpasswordsafe.server.dao.PasswordAccessAuditDAOHibernate">
        	<property name="sessionFactory" ref="sessionFactory" />
        </bean>
        
        <!-- transaction support -->
      	<tx:annotation-driven transaction-manager="transactionManager"/> 
      	
	  	<bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
	    	<property name="sessionFactory" ref="sessionFactory"/>
	  	</bean>
	  	
	  	<!--  Encryption related settings, these should not be changed after initial deployment otherwise
	  			data may be corrupted or unreadable -->
	  	<bean id="digester" class="com.joshdrummond.webpasswordsafe.server.encryption.JasyptDigester">
	  		<property name="passwordEncryptor" ref="passwordEncryptor" />
	  	</bean>
		<bean id="passwordEncryptor" class="org.jasypt.util.password.StrongPasswordEncryptor" />
		<bean id="encryptor" class="com.joshdrummond.webpasswordsafe.server.encryption.JasyptEncryptor">
			<property name="textEncryptor" ref="textEncryptor" />
		</bean>
		<bean id="textEncryptor" class="org.jasypt.util.text.StrongTextEncryptor">
			<property name="password" value="AS@BG!52faqef902" />
		</bean>
		
		<bean id="bcProvider" class="org.bouncycastle.jce.provider.BouncyCastleProvider" />
		<bean id="strongEncryptor" class="org.jasypt.encryption.pbe.StandardPBEStringEncryptor">
			<property name="algorithm" value="PBEWITHSHA256AND128BITAES-CBC-BC" />
			<property name="provider" ref="bcProvider" />
			<property name="password" value="AS@BG!52faqef902" />
			<property name="keyObtentionIterations" value="1000" />
		</bean>
		<bean id="hibernateStringEncryptor" class="org.jasypt.hibernate.encryptor.HibernatePBEStringEncryptor">
			<property name="registeredName" value="strongHibernateStringEncryptor" />
			<property name="encryptor" ref="strongEncryptor" />
		</bean>
</beans>
